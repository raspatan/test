"use strict";var el,init=function(){el={form:$("div.mTaF-form form"),formMp:$("div.thanks form"),copy:$("div.form div.title, div.form div.mTaF-form"),copyMp:$("div.thanks div.message"),thanks:$("div.thanks"),thanksMp:$("div.thanksMp")},fix(),window.location.hash.search("thanks")>0?showThanks():start(),window.location.hash.search("MPthanks")>0?showThanksMp():startMP()},fix=function(){var a=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),b=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor);a&&$("body").addClass("webkit"),b&&$("body").addClass("webkit");var c=c||{},d=!1,e=!1;if($.each($.browser,function(a,b){return"mozilla"===a&&e===!1?void(e=!0):void(e&&parseFloat(b)<4&&(d=!0))}),d&&(c.oldbrowser=!0),/MSIE (\d+\.\d+);/.test(navigator.userAgent)){c.ie=!0,$("body").attr("data-ie",!0);var f=Number(RegExp.$1);f<=9&&(c.oldbrowser=!0)}c.oldbrowser&&($("input, textarea").placeholder(),$("body").addClass("oldbrowser"))},startMP=function(){$("div.thanks form button.btn").on("onClick",onClickMp),el.formMp.submit(function(a){a.preventDefault(),ga("send",{hitType:"event",eventCategory:"formMP",eventAction:"click",eventLabel:$(this).attr("action")}),$("div.thanks form button.btn").trigger("onClick",[$(this).attr("action"),$(this).attr("data-form-id")])})},start=function(){$($("div.mTaF-form form button.btn")).on("onClick",onClick),el.form.submit(function(a){a.preventDefault(),ga("send",{hitType:"event",eventCategory:"form",eventAction:"click",eventLabel:$(this).attr("action")}),$($("div.mTaF-form form button.btn")).trigger("onClick",[$(this).attr("action"),$(this).attr("data-form-id")])})},getUserFields=function(a){var b,c;return b=el.form.filter("[data-form-id='"+a+"']"),c={},$.each(b.find("input, checkbox, textarea"),function(a,b){c[$(b).attr("name")]=$(b).val()}),c},getUserFieldsMp=function(a){var b,c;return b=el.formMp.filter("[data-form-id='"+a+"']"),c={},$.each(b.find("input, checkbox, textarea"),function(a,b){c[$(b).attr("name")]=$(b).val()}),c},onClick=function(a,b,c){var d,e;d=getUserFields(c),d.form_id=c,e=$('meta[name="csrf-token"]').attr("content")===$("#token").attr("value"),postUserFields(d,function(a){if(a.success===!0&&e){ga("send",{hitType:"event",eventCategory:"form",eventAction:"post",eventLabel:!0}),showThanks(d);var b="#thanks",c=$(b);$("html, body").stop().animate({scrollTop:c.offset().top},900,"swing",function(){window.location.hash=b})}else ga("send",{hitType:"event",eventCategory:"form",eventAction:"post",eventLabel:!1,eventValue:a.code}),showError(a.code)})},onClickMp=function(a,b,c){var d,e;d=getUserFieldsMp(c),d.form_id=c,e=$('meta[name="csrf-token"]').attr("content")===$("#tokenMp").attr("value"),postUserFieldsMp(d,function(a){if(a.success===!0&&e){ga("send",{hitType:"event",eventCategory:"formMp",eventAction:"post",eventLabel:!0}),showThanksMp(d);var b="#MPthanks",c=$(b);$("html, body").stop().animate({scrollTop:c.offset().top-40},900,"swing",function(){window.location.hash=b})}else ga("send",{hitType:"event",eventCategory:"formMp",eventAction:"post",eventLabel:!1,eventValue:a.code}),showErrorMp(a.code)})},showError=function(a){var b="Something went wrong, please check the form and try again.";$("div.mTaF-form div.error").html(b),$("div.mTaF-form div.error").addClass("active").delay(2500).queue(function(a){$(this).removeClass("active"),a()})},showErrorMp=function(a){var b="Something went wrong, please check the form and try again.";$("div.thanks div.error").html(b),$("div.thanks div.error").addClass("active").delay(2500).queue(function(a){$(this).removeClass("active"),a()})},showThanks=function(a){window.location.hash="thanks";var b=window.location.pathname;"/"===b||"/a1"===b||"/a2"===b?ga("send",{hitType:"event",eventCategory:"page",eventAction:"load",eventLabel:"maketheairfair/#thanks"}):ga("send",{hitType:"event",eventCategory:"page",eventAction:"load",eventLabel:"maketheairfair/#thanks"+b}),a=a?a:0;var c,d,e;c='<strong>Look out for a call from <span class="pink">0800 358 7279</span> in the next few days',d=' Or if you can\'t wait, call us on <span class="pink">0800 358 7279</span>.</strong>',e=[c+"."+d,c+', in the <span class="pink">morning</span>.'+d,c+', in the <span class="pink">afternoon</span>.'+d,c+', in the <span class="pink">evening</span>.</strong>',c+"."+d],el.copy.fadeOut(0),el.thanks.addClass("active");var f=Math.random()+"",g=1e13*f;el.copyMp.append('<iframe class="ofcomFrame" src="https://4017114.fls.doubleclick.net/activityi;src=4017114;type=campa0;cat=spect00;u8=[Crumb1];u9=[Crumb2];u10=[Crumb3];u11=[Crumb4];u13=[URL];dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;ord='+g+'?" width="1" height="1" frameborder="0" style="display:none"></iframe>'),setTimeout(function(){history.pushState("",document.title,window.location.pathname)},950)},showThanksMp=function(a){window.location.hash="MPthanks";var b=window.location.pathname;"/"===b||"/a1"===b||"/a2"===b?ga("send",{hitType:"event",eventCategory:"page",eventAction:"load",eventLabel:"maketheairfair/#MPthanks"}):ga("send",{hitType:"event",eventCategory:"page",eventAction:"load",eventLabel:"maketheairfair/#MPthanks"+b}),a=a?a:0;var c,d,e;c='<strong>Look out for a call from <span class="pink">0800 358 7279</span> in the next few days',d=' Or if you can\'t wait, call us on <span class="pink">0800 358 7279</span>.</strong>',e=[c+"."+d,c+', in the <span class="pink">morning</span>.'+d,c+', in the <span class="pink">afternoon</span>.'+d,c+', in the <span class="pink">evening</span>.</strong>',c+"."+d],el.copyMp.fadeOut(0),el.thanksMp.addClass("active");var f=Math.random()+"",g=1e13*f;$("iframe.ofcomFrame").remove(),el.thanksMp.append('<iframe src="https://4017114.fls.doubleclick.net/activityi;src=4017114;type=campa0;cat=spect0;u8=[Crumb1];u9=[Crumb2];u10=[Crumb3];u11=[Crumb4];u13=[URL];dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;ord='+g+'?" width="1" height="1" frameborder="0" style="display:none"></iframe>'),setTimeout(function(){history.pushState("",document.title,window.location.pathname)},950)},validatePhoneNumber=function(a){var b,c;return c=!1,b=a.substring(0,2),b="44"===b,$.isNumeric(a)?a.length<10||a.length>15?c=!0:b||(c=!0):c=!0,c},validateUserFields=function(a){var b=0;return $.each(a,function(a,c){0===b&&(!c.length||c.length<2)&&(b=a),0===b&&validatePhoneNumber(c)&&(b=a)}),b},validateUserFieldsMp=function(a){var b=0;return $.each(a,function(a,c){0===b&&(!c.length||c.length<2)&&(b=a),0===b&&validatePhoneNumber(c)&&(b=a)}),b},postUserFields=function(a,b){var c,d;d="localhost"!==window.location.host,c={},d?$.post("/ofcom/api/submit/form/",a,function(a){b&&b(a)}):b&&(c.success=!0,b(c))},postUserFieldsMp=function(a,b){var c,d;d="localhost"!==window.location.host,c={},d?$.post("/ofcom/apiMp/submit/form/",a,function(a){b&&b(a)}):b&&(c.success=!0,b(c))},Links={selector:"[data-target]",targetNewWindow:"new-window",$viewport:$("html, body"),scrollDuration:600,init:function(){$(this.selector).length&&this.bindClick()},bindClick:function(){$(this.selector).on("click.link",function(a){var b=$(this),c=b.attr("href"),d=b.data("target");switch(d){case Links.targetNewWindow:Links.newWindow(c)}a.preventDefault()})},newWindow:function(a){var b=420,c=500,d="no",e="yes";window.open(a,"popup","width="+c+", height="+b+", scrollbars="+d+", resizable="+e)}};$(document).ready(function(){function a(a,b,c){if(c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*7e3);var e="; expires="+d.toGMTString()}else var e="";document.cookie=a+"="+b+e+"; path=/"}function b(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return null}function c(){document.cookie=k+"=true;"+g+"; path=/",window[k]=!0}Links.init(),init(),$("a[href*=#]:not([href=#])").click(function(){if(location.pathname.replace(/^\//,"")===this.pathname.replace(/^\//,"")&&location.hostname===this.hostname){var a=$(this.hash);if(a=a.length?a:$("[name="+this.hash.slice(1)+"]"),a.length)return $("html,body").animate({scrollTop:a.offset().top},1e3),!1}}),$("input#accept").change(function(){$("input#accept").is(":checked")?$("input#accept").val("Yes"):$("input#accept").val("No")}),$("input#contact").change(function(){$("input#contact").is(":checked")?$("input#contact").val("Yes"):$("input#contact").val("No")});var d=new Date;d.setDate(d.getDate()+1);var e=d.getMonth()+1;e<10&&(e="0"+e);var f=d.getDate()+"."+e+"."+d.getFullYear();$("#ofcom-date").val(f),$("div.mTaF-form form button.ofcom").click(function(){var a=$("input#ofcom-name").attr("value"),b=$("input#ofcom-last").attr("value"),c=$("input#ofcom-email").attr("value"),d=$("input#ofcom-date").attr("value");$("div.mpFormWrap input#ofcom-name-mpForm").val(a),$("div.mpFormWrap input#ofcom-last-mpForm").val(b),$("div.mpFormWrap input#ofcom-email-mpForm").val(c),$("div.mpFormWrap input#ofcom-date-mpForm").val(d)}),$("#three-post").setupPostcodeLookup({api_key:"ak_ivuvo8reRqP9sBJbpub6fujdRZWkz",output_fields:{line_1:"#first_line",line_2:"#second_line",line_3:"#third_line",post_town:"#post_town",postcode:"#postcode"}}),$("div.thanks input#idpc_input").attr("placeholder","Please add your postcode"),$("div.thanks input#idpc_input").attr("value",""),$("div.thanks input#idpc_input").attr("name","postcodesearch"),$("div#three-post button#idpc_button").prop("disabled",!0),$("div.thanks div.message form input#idpc_input").keyup(function(){var a=$("div.thanks div.message form input#idpc_input").val();a.length;a.length>=5?$("div#three-post button#idpc_button").prop("disabled",!1):$("div#three-post button#idpc_button").prop("disabled",!0)}),$("div#three-post button#idpc_button").click(function(){var a=$("div.thanks div.message form input#idpc_input").val(),b=a.length,c=a.replace(/ /g,"+"),d="https://iparlsetup.com/lookup/mp/"+c,e=$("#idpc_error_message").length,f=e>=0,g=null===document.getElementById("idpc_error_message");f&&setTimeout(function(){$("#idpc_error_message").hide(),$("div.thanks img.load").hide()},2500),b>=5&&g&&($("div.thanks img.load").show(),$.ajax({type:"get",url:d,dataType:"xml",success:function(a){$(a).find("email").text().length&&($("div.thanks div.message form input#ofcom-mpemail").val($(a).find("email").text()),$("div.thanks div.message form input#ofcom-mpname").val($(a).find("name").text()),$("div.thanks div.message form input#ofcom-mpConst").val($(a).find("wmc").text()),$("div.thanks div.message div.mpFormWrap div.petitionMp span#mp").html($(a).find("name").text()),$("div.thanks div.message div.mpFormWrap div.petitionMp span#constituency").html($(a).find("wmc").text()),$("div.thanks img.load").hide(),$("div.thanks div.addressRow").addClass("active"))},error:function(){$("div.thanks img.load").hide()}}))}),b("GA")||setTimeout(function(){$("div.cookie").addClass("active")},500),$("div.cookie a.accept").click(function(){$("div.cookie").removeClass("active"),a("GA","I accept the cookie",1),setTimeout(function(){$("div.cookie").remove()},500)});var g=new Date,h=g.getTime(),i=h+6048e5;g.setTime(i);var j="UA-82653810-1",k="ga-disable-"+j;document.cookie.indexOf(k+"=true")>-1&&(window[k]=!0),$("div.cookie a.doNotAccept").click(function(){c(),$("div.cookie").removeClass("active")}),$("a.view_less").hide(),$("a.view").click(function(){$("div.mTaF-form div.petition").addClass("open"),$("a.view_less").show(),$("a.view").hide()}),$("a.view_less").click(function(){$("div.mTaF-form div.petition").removeClass("open"),$("a.view").show(),$("a.view_less ").hide()}),$("a.view_lessMp").hide(),$("a.viewMp").click(function(){$("div.thanks div.petitionMp").addClass("open"),$("a.view_lessMp").show(),$("a.viewMp").hide()}),$("a.view_lessMp").click(function(){$("div.thanks div.petitionMp").removeClass("open"),$("a.viewMp").show(),$("a.view_lessMp").hide()}),$("div.tab a.tab-header").click(function(){$(this).parent().toggleClass("open").siblings("div.tab").removeClass("open")})}),$(window).load(function(){var a={selector:"[data-track]",init:function(){$(this.selector).length&&this.bindClick()},bindClick:function(){$(this.selector).on("click",function(){var b=$(this);a.clickEvent(b)})},clickEvent:function(a){var b=a.data("track"),c=a.attr("title"),d=a.data("click"),e=1;try{ga("send","event",b,d,c,e)}catch(f){}}};a.init()});